<div class="torch-system">
  <div 
    *ngFor="let torch of torches" 
    [id]="torch.id"
    class="torch-container"
    [ngClass]="getTorchClass(torch)"
    [ngStyle]="getTorchStyle(torch)"
    (click)="onTorchClick(torch)"
  >
    <!-- Tech Matrix Torch SVG -->
    <svg class="torch-svg" width="60" height="90" viewBox="0 0 60 90" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <!-- Gradients for metallic handle -->
        <linearGradient [id]="'metalHandle-' + torch.id" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" stop-color="#e0e0e0"/>
          <stop offset="25%" stop-color="#c0c0c0"/>
          <stop offset="50%" stop-color="#888"/>
          <stop offset="75%" stop-color="#666"/>
          <stop offset="100%" stop-color="#444"/>
        </linearGradient>
        
        <!-- Cup gradient -->
        <linearGradient [id]="'metalCup-' + torch.id" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" stop-color="#f0f0f0"/>
          <stop offset="30%" stop-color="#c8c8c8"/>
          <stop offset="70%" stop-color="#999"/>
          <stop offset="100%" stop-color="#777"/>
        </linearGradient>
        
        <!-- Matrix flame gradient -->
        <linearGradient [id]="'matrixFlame-' + torch.id" x1="0%" y1="100%" x2="0%" y2="0%">
          <stop offset="0%" stop-color="#00ff44"/>
          <stop offset="30%" stop-color="#00cc33"/>
          <stop offset="60%" stop-color="#00aa22"/>
          <stop offset="100%" stop-color="#008811"/>
        </linearGradient>
        
        <!-- Green glow -->
        <radialGradient [id]="'greenGlow-' + torch.id" cx="50%" cy="50%" r="60%">
          <stop offset="0%" stop-color="#00ff44" stop-opacity="0.6"/>
          <stop offset="100%" stop-color="#00ff44" stop-opacity="0"/>
        </radialGradient>
      </defs>
      
      <!-- Resplandor (only when lit) -->
      <circle 
        *ngIf="torch.isLit" 
        cx="30" 
        cy="25" 
        r="35" 
        [attr.fill]="'url(#greenGlow-' + torch.id + ')'"
        class="glow-effect"
      />
      
      <!-- Metallic handle with tech details -->
      <rect x="26" y="35" width="8" height="50" 
            [attr.fill]="'url(#metalHandle-' + torch.id + ')'" 
            stroke="#00ff44" 
            stroke-width="0.5" 
            rx="1"
            [attr.opacity]="torch.isLit ? 1 : 0.4"/>
      
      <!-- Tech hexagons on handle -->
      <polygon points="22,42 38,42 36,50 24,50" 
               [attr.fill]="'url(#metalHandle-' + torch.id + ')'" 
               stroke="#00ff44" 
               stroke-width="0.5"
               [attr.opacity]="torch.isLit ? 0.8 : 0.3"/>
      <polygon points="23,58 37,58 35,65 25,65" 
               [attr.fill]="'url(#metalHandle-' + torch.id + ')'" 
               stroke="#00ff44" 
               stroke-width="0.5"
               [attr.opacity]="torch.isLit ? 0.8 : 0.3"/>
      
      <!-- LEDs on handle (only visible when lit) -->
      <circle *ngIf="torch.isLit" cx="30" cy="46" r="1.2" fill="#00ff44" opacity="0.9">
        <animate attributeName="opacity" values="0.9;1;0.9" dur="1.2s" repeatCount="indefinite"/>
      </circle>
      <circle *ngIf="torch.isLit" cx="30" cy="61" r="1.2" fill="#00cc33" opacity="0.7">
        <animate attributeName="opacity" values="0.7;1;0.7" dur="1.5s" repeatCount="indefinite"/>
      </circle>
      
      <!-- Metallic cup -->
      <ellipse cx="30" cy="32" rx="16" ry="5" 
               [attr.fill]="'url(#metalCup-' + torch.id + ')'" 
               stroke="#00ff44" 
               stroke-width="1"
               [attr.opacity]="torch.isLit ? 1 : 0.4"/>
      <rect x="14" y="25" width="32" height="12" 
            [attr.fill]="'url(#metalCup-' + torch.id + ')'" 
            stroke="#00ff44" 
            stroke-width="1" 
            rx="2"
            [attr.opacity]="torch.isLit ? 1 : 0.4"/>
      <ellipse cx="30" cy="25" rx="16" ry="5" 
               fill="#ddd" 
               stroke="#00ff44" 
               stroke-width="1"
               [attr.opacity]="torch.isLit ? 1 : 0.4"/>
      
      <!-- Matrix flame (only when lit) -->
      <g *ngIf="torch.isLit">
        <path d="M16 25 Q30 3 44 25 Q40 38 34 32 Q30 35 26 32 Q20 38 16 25" 
              [attr.fill]="'url(#matrixFlame-' + torch.id + ')'" 
              class="flame-main">
          <animateTransform attributeName="transform" 
                            type="scale" 
                            values="1;1.05;0.95;1" 
                            dur="0.8s" 
                            repeatCount="indefinite"/>
        </path>
        
        <!-- Inner flame -->
        <path d="M20 25 Q30 8 40 25 Q36 32 32 28 Q30 30 28 28 Q24 32 20 25" 
              fill="#00ff44" 
              opacity="0.8">
          <animateTransform attributeName="transform" 
                            type="scale" 
                            values="1;1.1;0.9;1" 
                            dur="1s" 
                            repeatCount="indefinite"/>
        </path>
      </g>
      
      <!-- Matrix binary particles (only when lit) -->
      <g *ngIf="torch.isLit" class="matrix-particles">
        <text x="18" y="12" fill="#00ff44" font-size="4" font-family="monospace" opacity="0.9">1</text>
        <text x="38" y="8" fill="#00cc33" font-size="3" font-family="monospace" opacity="0.8">0</text>
        <text x="26" y="10" fill="#00aa22" font-size="4" font-family="monospace" opacity="0.7">1</text>
        <text x="34" y="15" fill="#008811" font-size="3" font-family="monospace" opacity="0.9">0</text>
        <text x="22" y="18" fill="#00ff44" font-size="3" font-family="monospace" opacity="0.6">1</text>
        <text x="40" y="20" fill="#00cc33" font-size="4" font-family="monospace" opacity="0.8">0</text>
      </g>
    </svg>
    
    <!-- Subtle hint pulse (only when hintVisible) -->
    <div *ngIf="torch.hintVisible" class="hint-pulse"></div>
  </div>
</div>